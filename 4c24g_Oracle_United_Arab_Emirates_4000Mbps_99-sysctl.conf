# 以下代码块，放入/etc/sysctl.conf 替换
#
# source: https://t.me/VKVM_info/105
#
# /etc/sysctl.conf 参数，感觉服务器带宽异常跑不动的可以试试看，参数如下

vm.swappiness = 10
vm.dirty_ratio = 15
vm.dirty_background_ratio = 5
vm.overcommit_memory = 1
vm.min_free_kbytes = 65536
vm.overcommit_ratio = 100
net.core.rmem_max = 67108864
net.core.wmem_max = 16777216
net.core.netdev_max_backlog = 250000
net.core.somaxconn = 4096
net.core.default_qdisc = fq
# 本地用户路由器主要调rmem就行了，wmem是发送
# ①最右边的数值: 最佳设定是 := 字节数/延迟
## 假如你算全国离你最远的用户100ms (就是/0.1); 你写的32M，除以0.1，离你最远的用户可以跑320MB/s
# ②中间的数值: 中间的主要影响大量小带宽请求
## 一般写个 65535 或者顶多 131070 就够了
## Claude: 所以如果服务器内存较小（如1GB或2GB），且连接数可能达到1000以上时： 建议使用65535作为中间值，可以节省一半的缓冲区内存占用
## Claude: 如果服务器内存充足（8GB以上），且需要更好的性能： 可以考虑使用 131070 作为中间值, 能提供更好的网络性能
## 经验：中间值和最大值 要同增同减 (不等比也行)
net.ipv4.tcp_rmem = 4096 163840 5000000000
# ubuntu默认的[wmem]中间值 16384 (16KB)
net.ipv4.tcp_wmem = 4096 131070 5000000000
net.ipv4.tcp_congestion_control = bbr
net.ipv4.tcp_max_syn_backlog = 8192
net.ipv4.tcp_tw_reuse = 1
net.ipv4.ip_local_port_range = 1024 65535
net.ipv4.tcp_pacing_ca_ratio=110
net.ipv4.tcp_window_scaling=2
net.ipv4.tcp_mtu_probing = 1
net.ipv4.tcp_sack = 1
vm.vfs_cache_pressure = 30
kernel.sched_autogroup_enabled = 0
kernel.numa_balancing = 0
